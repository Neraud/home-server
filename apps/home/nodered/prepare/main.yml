---

- name: Check if Node-RED is already configured
  stat:
    path: "{{ item.mount_path }}/settings.js"
  register: nodered_settings_file 

- name: Configure Node-RED for the fist run (templates)
  template:
    src: "{{ config_item }}.j2"
    dest: "{{ item.mount_path }}/{{ config_item }}"
    backup: true
  loop:
    - settings.js
  loop_control:
    loop_var: config_item
  when: not nodered_settings_file.stat.exists

- name: Configure Node-RED for the fist run (copy)
  copy:
    src: "{{ config_item }}"
    dest: "{{ item.mount_path }}/{{ config_item }}"
    backup: true
  loop:
    - flows.json
  loop_control:
    loop_var: config_item
  when: not nodered_settings_file.stat.exists
