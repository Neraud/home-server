---

- name: Install GO requirements
  apt:
    pkg:
      - golang-go
      - go-dep
    state: present

- name: Install Keepalived exporter
  command: go get -v github.com/gen2brain/keepalived_exporter
  environment:
    GOPATH: "{{ keepalived.exporter.path }}"
  register: install_result
  changed_when: "install_result.stdout_lines | length > 0"
  notify: Restart Keepalived Exporter

- name: Create systemd service
  template:
    src: keepalived-exporter.service.j2
    dest: /etc/systemd/system/keepalived-exporter.service
  notify: Restart Keepalived Exporter

- name: Auto-start keepalived-exporter
  service:
    name: keepalived-exporter.service
    state: started
    enabled: yes
