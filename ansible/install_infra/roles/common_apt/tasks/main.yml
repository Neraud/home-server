---
- name: Disable APT recommended packages
  ansible.builtin.template:
    src: recommends.j2
    dest: /etc/apt/apt.conf.d/60recommends
    mode: 0644

- name: Update Debian sources list
  ansible.builtin.deb822_repository:
    name: debian
    types:
      - deb
      - deb-src
    uris: https://deb.debian.org/debian
    suites:
      - "{{ ansible_lsb.codename }}"
      - "{{ ansible_lsb.codename }}-updates"
    components:
      - main
      - contrib
      - non-free
      - non-free-firmware
    signed_by: /usr/share/keyrings/debian-archive-keyring.gpg
  when: ansible_distribution == 'Debian'

- name: Update Debian security sources list
  ansible.builtin.deb822_repository:
    name: debian-security
    types:
      - deb
      - deb-src
    uris: https://security.debian.org/debian-security
    suites:
      - "{{ ansible_lsb.codename }}-security"
    components:
      - main
      - contrib
      - non-free
      - non-free-firmware
    signed_by: /usr/share/keyrings/debian-archive-keyring.gpg
  when: ansible_distribution == 'Debian'

- import_tasks: unattended_upgrades.yml
  when: ansible_distribution == 'Debian'
