---
# apt list -a kubelet
kubernetes_version: 1.24.7-00

# To install from the binaries, configure the following
#kubernetes_from_binary: True
#kubernetes_binary_version: v1.24.0-alpha.3  # See https://gcsweb.k8s.io/gcs/kubernetes-release/release
#kubernetes_binary_release_version: master # See https://github.com/kubernetes/release
#kubernetes_binary_crictl_version: v1.23.0 # See https://github.com/kubernetes-sigs/cri-tools/releases
#kubernetes_binary_folder: /usr/local/bin
#kubernetes_binary_cni_plugins_version: v1.1.1 # See https://github.com/containernetworking/plugins/releases
# Also set kubernetes_control_plane_version_override in home-server-provisioning/ansible/install_infra/roles/kubernetes_master_bootstrap/defaults/main.yml

kubernetes_kubelet_system_reserved_cpu: 500m
kubernetes_kubelet_system_reserved_memory: 512M

kubernetes_kubelet_extra_parameters:
  - "--node-ip {{ kubernetes_kubelet_ip}}"
  # Enable WebHook for Prometheus
  - "--authorization-mode=Webhook"
  - "--authentication-token-webhook=true"
  - "--system-reserved=cpu={{ kubernetes_kubelet_system_reserved_cpu }},memory={{ kubernetes_kubelet_system_reserved_memory }}"
  # Use CRI-O
  - "--container-runtime=remote" # Use remote runtime with provided socket.
  - "--container-runtime-endpoint=unix:///var/run/crio/crio.sock" # Socket for remote runtime (default crio socket localization).
  - "--runtime-request-timeout=10m" # Optional but useful. Some requests, especially pulling huge images, may take longer than default (2 minutes) and will cause an error.
  # avoid "Failed to start ContainerManager failed to initialise top level QOS containers" error (ref: https://github.com/kubernetes/kubernetes/issues/43856)
  # avoid "kubelet crashes with: root container [kubepods] doesn't exist" (ref: https://github.com/kubernetes/kubernetes/issues/95488)
  # Also configured in kubeadm_config.yaml
  - --cgroups-per-qos=false
  - --enforce-node-allocatable=''