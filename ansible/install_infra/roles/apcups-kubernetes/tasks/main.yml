---

- name: Create Kubernetes namespace
  k8s:
    api_version: v1
    kind: Namespace
    name: monitoring-apcups-exporter
    state: present
  become: yes
  become_user: "{{ kubernetes_user.name }}"

- name: Create Kubernetes service
  k8s:
    definition: "{{ lookup('template', 'kubernetes/' + item) }}"
    state: present
  with_items:
    - endpoint.yaml.j2
    - service.yaml.j2
  become: yes
  become_user: "{{ kubernetes_user.name }}"
