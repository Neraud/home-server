---

#nginx_ssl_dhparam_generate: True

nginx_upstreams:
  - name: kubernetes-http-ingress
    servers:
      - 192.168.100.10:{{ kubernetes_ingress_http_port }}
      - 192.168.100.11:{{ kubernetes_ingress_http_port }}
      - 192.168.100.12:{{ kubernetes_ingress_http_port }}
  - name: kubernetes-lemonldap-handler-ingress
    servers:
      - 192.168.100.10:{{ kubernetes_ingress_lemonLdap_handler_port }}
      - 192.168.100.11:{{ kubernetes_ingress_lemonLdap_handler_port }}
      - 192.168.100.12:{{ kubernetes_ingress_lemonLdap_handler_port }}
  - name: kubernetes-mqtt-ingress
    servers:
      - 192.168.100.10:{{ kubernetes_ingress_mqtt_port }}
      - 192.168.100.11:{{ kubernetes_ingress_mqtt_port }}
      - 192.168.100.12:{{ kubernetes_ingress_mqtt_port }}
    

nginx_sites:
  - name: default-site
    enabled_name: 000-default-site
    server_name: "{{ web_base_domain }}"
    default: True
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN={{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/_star_.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/_star_.{{ web_base_domain }}/server.key
    force_http_to_https: False
    root: /var/www/html
    disable_robots: True

  - name: infra
    enabled_name: 100-infra
    server_name: "infra.{{ web_base_domain }}"
    default: False
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=infra.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/infra.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/infra.{{ web_base_domain }}/server.key
    force_http_to_https: True
    root: /var/www/html
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        lemonLdap_protected: True 
        proxy_pass: http://kubernetes-http-ingress

  - name: infra-unifi
    enabled_name: 110-infra-unifi
    server_name: "unifi.{{ web_base_domain }}"
    default: False
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=unifi.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/unifi.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/unifi.{{ web_base_domain }}/server.key
    force_http_to_https: True
    root: /var/www/html
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        lemonLdap_protected: True 
        proxy_pass: http://kubernetes-http-ingress
        proxy_enable_websocket: True

  - name: web
    enabled_name: 200-web
    server_name: "web.{{ web_base_domain }}"
    default: False
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=web.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/web.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/web.{{ web_base_domain }}/server.key
    force_http_to_https: True
    root: /var/www/html
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        lemonLdap_protected: True 
        proxy_pass: http://kubernetes-http-ingress

  - name: home
    enabled_name: 300-home
    server_name: "home.{{ web_base_domain }}"
    default: False
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=home.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/home.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/home.{{ web_base_domain }}/server.key
    force_http_to_https: True
    root: /var/www/html
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        proxy_pass: http://kubernetes-http-ingress
        proxy_enable_websocket: True
        lemonLdap_protected: True 

  - name: stream
    enabled_name: 400-stream
    server_name: "stream.{{ web_base_domain }}"
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=stream.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/stream.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/stream.{{ web_base_domain }}/server.key
    force_http_to_https: True
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        proxy_pass: http://kubernetes-http-ingress
        proxy_enable_websocket: True
        lemonLdap_protected: True 

  - name: streams-plex
    enabled_name: 410-stream-plex
    server_name: "plex.{{ web_base_domain }}"
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=plex.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/plex.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/plex.{{ web_base_domain }}/server.key
    force_http_to_https: True
    disable_robots: True
    locations:
      - path: /
        proxy_pass: http://kubernetes-http-ingress
        proxy_enable_websocket: True

  - name: dev
    enabled_name: 500-dev
    server_name: "dev.{{ web_base_domain }}"
    http_port: 80
    https_port: 443
    https_cert:
      mode: selfsigned
      subject: "/C=FR/ST=France/L=Paris/O=Test/CN=dev.{{ web_base_domain }}"
      cert_path: /etc/nginx/ssl/dev.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/dev.{{ web_base_domain }}/server.key
    force_http_to_https: True
    disable_robots: True
    lemonLdap:
      path: /lmauth
      proxy_pass: kubernetes-lemonldap-handler-ingress
    locations:
      - path: /
        proxy_pass: http://kubernetes-http-ingress
        proxy_enable_websocket: True
        lemonLdap_protected: True 

nginx_streams:
  - name: home_mqtt
    enabled_name: 100-home_mqtt
    http_port: False
    https_port: 8883
    https_cert:
      mode: file
      cert_path: /etc/nginx/ssl/home.{{ web_base_domain }}/server.crt
      cert_key_path: /etc/nginx/ssl/home.{{ web_base_domain }}/server.key
    proxy_pass: kubernetes-mqtt-ingress

