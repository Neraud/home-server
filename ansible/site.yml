---

- name: Prepare all hosts
  hosts: all
  roles:
    - common
    - common-apt
    - udev
    - firewall

- name: Prepare Ansible requirements
  hosts: ansible
  roles:
    - kubernetes-ansible

- name: Prepare Kubernetes members
  hosts: kubernetes
  roles:
    - docker
    - kubernetes-common

- name: Provision Kubernetes masters
  hosts: kubernetes_masters
  roles:
    - {
        role: nginx,
        tags: nginx
      }
    - fail2ban
    - kubernetes-master

- name: Provision Kubernetes nodes
  hosts: kubernetes_nodes
  roles:
    - kubernetes-node
    - {
        role: kubernetes-apps-prepare,
        tags: kubernetes-apps
      }

- name: Provision Kubernetes applications
  hosts: kubernetes_masters
  roles:
    - kubernetes-infra
    - {
        role: kubernetes-apps-deploy,
        tags: kubernetes-apps
      }
