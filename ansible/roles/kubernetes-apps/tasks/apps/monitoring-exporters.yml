---

# TODO : analyze why kube-state-metrics-deployment.yaml is always changed
- name: Deploy Kube State metrics
  k8s:
    definition: "{{ lookup(item | regex_search('.j2$') | ternary('template','file'), item) }}"
    state: present
  with_fileglob:
    - "{{ kubernetes_app_root_path }}/monitoring/exporters/deploy/kube-state-metrics/*.yaml*"
  become: yes
  become_user: "{{ kubernetes_user.name }}"

- name: Deploy node exporter
  k8s:
    definition: "{{ lookup(item | regex_search('.j2$') | ternary('template','file'), item) }}"
    state: present
  with_fileglob:
    - "{{ kubernetes_app_root_path }}/monitoring/exporters/deploy/node-exporter/*.yaml*"
  become: yes
  become_user: "{{ kubernetes_user.name }}"
