---

- name: Install dnsmasq
  apt:
    pkg:
    - dnsmasq
    state: present

- name: Configure dnsmasq
  template:
    src: dnsmasq.conf.j2
    dest: /etc/dnsmasq.conf
    backup: yes
  notify: Restart dnsmasq

- name: Fill /etc/hosts with local machines
  blockinfile:
    path: /etc/hosts
    block: |
      {% for dns_local_host in dns_local_hosts %}
      {{ dns_local_host.ip }} {{ dns_local_host.name }}
      {% endfor %}
  notify: Restart dnsmasq

- name: Auto-start dnsmasq
  service:
    name: dnsmasq
    state: started
    enabled: yes
