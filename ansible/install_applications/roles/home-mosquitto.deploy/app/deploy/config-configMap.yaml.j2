apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: {{ mosquitto.namespace }}
  labels:
    app.kubernetes.io/name: mosquitto
    app.kubernetes.io/component: mosquitto
data:
{% for mosquitto_config_file in mosquitto_config_files %}
  {{ mosquitto_config_file | basename | replace(".j2", "") }}: |
    {{ lookup(mosquitto_config_file | regex_search('.j2$') | ternary('template','file'), mosquitto_config_file) | replace('\n', '\n    ') }}
{% endfor %}
