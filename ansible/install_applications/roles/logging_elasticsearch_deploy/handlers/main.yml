---
# Security configuration changes are only taken into account the first time ES is deployed, or after running securityadmin.sh
# The following tasks ensures that each time something changes in ES deployment, security configurations are properly updated.
- name: Reconfigure security
  ansible.builtin.command: kubectl {{ kubectl_params }} \
    --namespace={{ elasticsearch.namespace }} exec -it elasticsearch-0 -- \
    bash /usr/share/opensearch/plugins/opensearch-security/tools/securityadmin.sh \
    -icl -nhnv \
    -cd /usr/share/opensearch/plugins/opensearch-security/securityconfig/ \
    -cacert /usr/share/opensearch/config/certs/ca.crt \
    -cert /usr/share/opensearch/config/certs/server.crt \
    -key /usr/share/opensearch/config/certs/server.key
  listen: "Reconfigure OpenSearch security"
