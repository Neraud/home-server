-- Create Role
CREATE ROLE readaccess;

-- Assign Permission
GRANT CONNECT ON DATABASE {{ blocky_pgsql.database }} TO readaccess;
--GRANT USAGE ON SCHEMA public TO readaccess;
--GRANT SELECT ON ALL TABLES IN SCHEMA public TO readaccess;

-- Grant access to future tables
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO readaccess;

-- Create a final user with password
CREATE USER {{ blocky_pgsql.readonly.user }} WITH PASSWORD '{{ blocky_pgsql.readonly.password }}';
GRANT readaccess TO {{ blocky_pgsql.readonly.user }};
