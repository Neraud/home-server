# K8S 1.33.4 upgrades

## Master-1

```bash
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.asc] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /" > /etc/apt/sources.list.d/kubernetes.list
apt-get update
apt-get install -y --allow-change-held-packages kubeadm=1.33.4-1.1

kubeadm upgrade plan

kubeadm upgrade apply v1.33.4
```

## other nodes

```bash
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.asc] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /" > /etc/apt/sources.list.d/kubernetes.list
apt-get update
apt-get install -y --allow-change-held-packages kubeadm=1.33.4-1.1

kubeadm upgrade node
```

## all nodes

```bash
# kubectl drain <node-to-drain> --ignore-daemonsets
echo "deb [signed-by=/etc/apt/keyrings/cri-o-apt-keyring.gpg] https://download.opensuse.org/repositories/isv:/cri-o:/stable:/v1.33/deb/ /" > /etc/apt/sources.list.d/cri-o.list
apt-get update

apt-get install -y --allow-change-held-packages kubelet=1.33.4-1.1 kubectl=1.33.4-1.1 cri-o=1.33.3-1.1

systemctl daemon-reload
systemctl restart kubelet
```

## ansible

Run role `kubernetes_node_preinstall` and `crio` to make sure the proper packages are held.
